

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>easy_robot_control.gait_key_dev &mdash; Motion-Stack 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/sphinx-toolbox.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Motion-Stack
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Guides:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../manual/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/start.html">How to start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/use.html">ROS2 nodes and interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/URDF.html">Your URDF with This Repo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/api.html">API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/easy_robot_control/easy_robot_control.html">easy_robot_control package</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Future code struct.:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/motion_stack/motion_stack.api.html">motion_stack.api package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/motion_stack/motion_stack.core.html">motion_stack.core package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/motion_stack/motion_stack.ros2.html">motion_stack.ros2 package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Motion-Stack</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">easy_robot_control.gait_key_dev</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for easy_robot_control.gait_key_dev</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This node is responsible for controlling movement of Moonbot HERO.</span>
<span class="sd">For now keyboard and controller (PS4).</span>

<span class="sd">Authors: Elian NEPPEL, Shamistan KARIMOV</span>
<span class="sd">Lab: SRL, Moonshot team</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">environ</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Final</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">overload</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">keyboard_msgs.msg</span> <span class="kn">import</span> <span class="n">Key</span>
<span class="kn">from</span> <span class="nn">motion_stack_msgs.msg</span> <span class="kn">import</span> <span class="n">TargetBody</span>
<span class="kn">from</span> <span class="nn">motion_stack_msgs.srv</span> <span class="kn">import</span> <span class="n">SendTargetBody</span>
<span class="kn">from</span> <span class="nn">numpy.typing</span> <span class="kn">import</span> <span class="n">NDArray</span>
<span class="kn">from</span> <span class="nn">rclpy.callback_groups</span> <span class="kn">import</span> <span class="n">MutuallyExclusiveCallbackGroup</span>
<span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Timer</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">from</span> <span class="nn">rclpy.task</span> <span class="kn">import</span> <span class="n">Future</span>
<span class="kn">from</span> <span class="nn">rclpy.time</span> <span class="kn">import</span> <span class="n">Duration</span>
<span class="kn">from</span> <span class="nn">sensor_msgs.msg</span> <span class="kn">import</span> <span class="n">Joy</span>  <span class="c1"># joystick, new</span>
<span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="n">Float64</span>
<span class="kn">from</span> <span class="nn">std_srvs.srv</span> <span class="kn">import</span> <span class="n">Empty</span><span class="p">,</span> <span class="n">Trigger</span>

<span class="kn">from</span> <span class="nn">easy_robot_control.EliaNode</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Client</span><span class="p">,</span>
    <span class="n">EliaNode</span><span class="p">,</span>
    <span class="n">error_catcher</span><span class="p">,</span>
    <span class="n">myMain</span><span class="p">,</span>
    <span class="n">np2TargetSet</span><span class="p">,</span>
    <span class="n">np2tf</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">easy_robot_control.leg_api</span> <span class="kn">import</span> <span class="n">JointMini</span><span class="p">,</span> <span class="n">Leg</span> <span class="k">as</span> <span class="n">PureLeg</span>
<span class="kn">from</span> <span class="nn">easy_robot_control.utils.math</span> <span class="kn">import</span> <span class="n">Quaternion</span><span class="p">,</span> <span class="n">qt</span>

<span class="c1"># VVV Settings to tweek</span>
<span class="c1">#</span>
<span class="n">LEGNUMS_TO_SCAN</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">75</span><span class="p">]</span>
<span class="c1"># LEGNUMS_TO_SCAN = [1]</span>
<span class="c1"># LEGNUMS_TO_SCAN = [1, 2, 3, 4]</span>
<span class="c1"># LEGNUMS_TO_SCAN = [75, 16]</span>
<span class="c1"># LEGNUMS_TO_SCAN = [3]</span>
<span class="n">WHEELS_NUM</span> <span class="o">=</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
<span class="n">TRANSLATION_SPEED</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># mm/s ; full stick will send this speed</span>
<span class="n">ROTATION_SPEED</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># rad/s ; full stick will send this angular speed</span>

<span class="c1"># Robot legs configuration</span>
<span class="n">DRAGON_MAIN</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">DRAGON_MANIP</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">VEHICLE_BRIDGE</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">TRICYCLE_FRONT</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">TRICYCLE_LEFT</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">TRICYCLE_RIGHT</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">TRICYCLE_FLIPPED</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">MAX_JOINT_SPEED</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="c1">#</span>
<span class="c1"># ^^^ Settings to tweek</span>

<span class="c1"># VVV dev related gloabl stuff</span>
<span class="c1">#</span>
<span class="n">float_formatter</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;float_kind&quot;</span><span class="p">:</span> <span class="n">float_formatter</span><span class="p">})</span>

<span class="c1"># type def V</span>
<span class="n">ANY</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ANY&quot;</span>
<span class="n">ALWAYS</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ALWAYS&quot;</span>
<span class="n">KeyCodeModifier</span> <span class="o">=</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ANY&quot;</span><span class="p">]]]</span>  <span class="c1"># keyboard input: key + modifier</span>
<span class="n">JoyBits</span> <span class="o">=</span> <span class="nb">int</span>  <span class="c1"># 32 bits to represent all buttons pressed or not</span>
<span class="n">ButtonName</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span>  <span class="c1"># type with all possible buttons</span>
    <span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
    <span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="s2">&quot;o&quot;</span><span class="p">,</span>
    <span class="s2">&quot;t&quot;</span><span class="p">,</span>
    <span class="s2">&quot;s&quot;</span><span class="p">,</span>
    <span class="s2">&quot;L1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;R1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;L2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;R2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;share&quot;</span><span class="p">,</span>
    <span class="s2">&quot;option&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;stickLpush&quot;</span><span class="p">,</span>
    <span class="s2">&quot;stickRpush&quot;</span><span class="p">,</span>
    <span class="s2">&quot;down&quot;</span><span class="p">,</span>
    <span class="s2">&quot;right&quot;</span><span class="p">,</span>
    <span class="s2">&quot;up&quot;</span><span class="p">,</span>
    <span class="s2">&quot;left&quot;</span><span class="p">,</span>
    <span class="s2">&quot;stickL&quot;</span><span class="p">,</span>
    <span class="s2">&quot;stickR&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">JoyCodeModifier</span> <span class="o">=</span> <span class="n">Tuple</span><span class="p">[</span>
    <span class="n">ButtonName</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">JoyBits</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ANY&quot;</span><span class="p">]]</span>
<span class="p">]</span>  <span class="c1"># joystick input: new press + JoyState</span>
<span class="n">UserInput</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>  <span class="c1"># type of keys to the dict that will give functions to execute</span>
    <span class="n">KeyCodeModifier</span><span class="p">,</span>
    <span class="n">JoyCodeModifier</span><span class="p">,</span>
    <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ALWAYS&quot;</span><span class="p">],</span>  <span class="c1"># functions associated with &quot;ALWAYS&quot; string will always execute</span>
<span class="p">]</span>
<span class="n">NakedCall</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Any</span><span class="p">]</span>
<span class="n">InputMap</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">[</span><span class="n">UserInput</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">NakedCall</span><span class="p">]]</span>  <span class="c1"># User input are linked to a list of function</span>

<span class="c1"># Namespace</span>
<span class="n">operator</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;OPERATOR&quot;</span><span class="p">))</span>
<span class="c1"># operator = &quot;elian&quot;</span>
<span class="n">INPUT_NAMESPACE</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">operator</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># Keys</span>
<span class="n">NOMOD</span> <span class="o">=</span> <span class="n">Key</span><span class="o">.</span><span class="n">MODIFIER_NUM</span>
<span class="n">STICKER_TO_ALPHAB</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="mi">9</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">ALPHAB_TO_STICKER</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">STICKER_TO_ALPHAB</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="n">STICKER_TO_ALPHAB_LEG75</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">ALPHAB_TO_STICKER_LEG75</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">STICKER_TO_ALPHAB_LEG75</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="n">STICKER_TO_ALPHAB_LEG42</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">ALPHAB_TO_STICKER_LEG42</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">STICKER_TO_ALPHAB_LEG42</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="n">STICKER_TO_ALPHAB_LEG16_ARM</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># first 1 to 6 is remap for launch without the gripper</span>
    <span class="mi">4</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="c1"># 1: 13,</span>
    <span class="c1"># 2: 12,</span>
    <span class="c1"># 3: 0,       # second 1 to 6 is remap for launch with gripper</span>
    <span class="c1"># 4: 14,</span>
    <span class="c1"># 5: 15,</span>
    <span class="c1"># 6: 16,</span>
<span class="p">}</span>

<span class="n">ALPHAB_TO_STICKER_LEG16_ARM</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">STICKER_TO_ALPHAB_LEG16_ARM</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="n">STICKER_TO_ALPHAB_LEG16_GRIP</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>  <span class="c1"># gripper joints (too many)</span>
    <span class="mi">6</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="mi">9</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="c1"># 10: 10,  # palm finger 1</span>
    <span class="c1"># 11: 11,  # palm finger 2</span>
<span class="p">}</span>

<span class="n">ALPHAB_TO_STICKER_LEG16_GRIP</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">STICKER_TO_ALPHAB_LEG16_GRIP</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="n">BUTT_BITS</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ButtonName</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>  <span class="c1"># button name to bit position</span>
    <span class="c1"># butts</span>
    <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;o&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="c1"># backs</span>
    <span class="s2">&quot;L1&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;R1&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;L2&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s2">&quot;R2&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="c1"># options</span>
    <span class="s2">&quot;share&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s2">&quot;option&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="s2">&quot;PS&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="c1"># stick pushed</span>
    <span class="s2">&quot;stickLpush&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
    <span class="s2">&quot;stickRpush&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
    <span class="c1"># dpad</span>
    <span class="s2">&quot;down&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
    <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
    <span class="s2">&quot;up&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
    <span class="c1"># sticks</span>
    <span class="s2">&quot;stickL&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>  <span class="c1"># left stick not centered</span>
    <span class="s2">&quot;stickR&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>  <span class="c1"># right stick not centered</span>
<span class="p">}</span>
<span class="n">BITS_BUTT</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ButtonName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">BUTT_BITS</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="c1"># Bitmask of each button</span>
<span class="n">BUTT_INTS</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ButtonName</span><span class="p">,</span> <span class="n">JoyBits</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">butt</span><span class="p">:</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bit</span> <span class="k">for</span> <span class="n">butt</span><span class="p">,</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">BUTT_BITS</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;NONE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">INTS_BUTT</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">JoyBits</span><span class="p">,</span> <span class="n">ButtonName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">BUTT_INTS</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">JoyState</span><span class="p">:</span>
    <span class="n">bits</span><span class="p">:</span> <span class="n">JoyBits</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">stickR</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">stickL</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">R2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">L2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>


<div class="viewcode-block" id="Leg">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.Leg">[docs]</a>
<span class="k">class</span> <span class="nc">Leg</span><span class="p">(</span><span class="n">PureLeg</span><span class="p">):</span>  <span class="c1"># overloads the general Leg class with stuff only for Moonbot Hero</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">EliaNode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recoverCLI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span>
            <span class="n">Trigger</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/leg</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="si">}</span><span class="s2">/driver/recover&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">haltCLI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span>
            <span class="n">Trigger</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/leg</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="si">}</span><span class="s2">/driver/halt&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset_ik2_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ik2</span><span class="o">.</span><span class="n">reset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_ik2_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ik2</span><span class="o">.</span><span class="n">offset</span>

<div class="viewcode-block" id="Leg.recover">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.Leg.recover">[docs]</a>
    <span class="k">def</span> <span class="nf">recover</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Future</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recoverCLI</span><span class="o">.</span><span class="n">call_async</span><span class="p">(</span><span class="n">Trigger</span><span class="o">.</span><span class="n">Request</span><span class="p">())</span></div>


<div class="viewcode-block" id="Leg.halt">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.Leg.halt">[docs]</a>
    <span class="k">def</span> <span class="nf">halt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Future</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">haltCLI</span><span class="o">.</span><span class="n">call_async</span><span class="p">(</span><span class="n">Trigger</span><span class="o">.</span><span class="n">Request</span><span class="p">())</span></div>
</div>



<div class="viewcode-block" id="Wheel">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.Wheel">[docs]</a>
<span class="k">class</span> <span class="nc">Wheel</span><span class="p">(</span><span class="n">Leg</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">EliaNode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">taskTMR</span><span class="p">:</span> <span class="n">Timer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">create_timer</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">())</span>

<div class="viewcode-block" id="Wheel.add_joints">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.Wheel.add_joints">[docs]</a>
    <span class="k">def</span> <span class="nf">add_joints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_joints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">JointMini</span><span class="p">]:</span>
        <span class="n">added</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_joints</span><span class="p">(</span><span class="n">all_joints</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">added</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">max_delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">added</span></div>


    <span class="k">def</span> <span class="nf">__speed_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="n">joints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">joints</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">apply_speed_target</span><span class="p">(</span><span class="n">velocity</span><span class="p">)</span>

<div class="viewcode-block" id="Wheel.connect_movement_clients">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.Wheel.connect_movement_clients">[docs]</a>
    <span class="k">def</span> <span class="nf">connect_movement_clients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Wheel.forward">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.Wheel.forward">[docs]</a>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__speed_all</span><span class="p">(</span><span class="n">MAX_JOINT_SPEED</span><span class="p">)</span></div>


<div class="viewcode-block" id="Wheel.backward">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.Wheel.backward">[docs]</a>
    <span class="k">def</span> <span class="nf">backward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__speed_all</span><span class="p">(</span><span class="o">-</span><span class="n">MAX_JOINT_SPEED</span><span class="p">)</span></div>


<div class="viewcode-block" id="Wheel.stop">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.Wheel.stop">[docs]</a>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__speed_all</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="KeyGaitNode">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode">[docs]</a>
<span class="k">class</span> <span class="nc">KeyGaitNode</span><span class="p">(</span><span class="n">EliaNode</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;keygait_node&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Alias</span> <span class="o">=</span> <span class="s2">&quot;K&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">leg_aliveCLI</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Client</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span><span class="n">Empty</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;leg</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">/joint_alive&quot;</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">LEGNUMS_TO_SCAN</span> <span class="o">+</span> <span class="n">WHEELS_NUM</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Leg</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wheels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Wheel</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">key_downSUB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span>
            <span class="n">Key</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">INPUT_NAMESPACE</span><span class="si">}</span><span class="s2">/keydown&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_downSUBCBK</span><span class="p">,</span> <span class="mi">10</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key_upSUB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span>
            <span class="n">Key</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">INPUT_NAMESPACE</span><span class="si">}</span><span class="s2">/keyup&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_upSUBCBK</span><span class="p">,</span> <span class="mi">10</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joySUB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span>
            <span class="n">Joy</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">INPUT_NAMESPACE</span><span class="si">}</span><span class="s2">/joy&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">joySUBCBK</span><span class="p">,</span> <span class="mi">10</span>
        <span class="p">)</span>  <span class="c1"># joystick, new</span>
        <span class="n">scan_group</span> <span class="o">=</span> <span class="n">MutuallyExclusiveCallbackGroup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wheel_scanTMR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_timer</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wheel_scanTMRCBK</span><span class="p">,</span> <span class="n">callback_group</span><span class="o">=</span><span class="n">scan_group</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">leg_scanTMR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_timer</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">leg_scanTMRCBK</span><span class="p">,</span> <span class="n">callback_group</span><span class="o">=</span><span class="n">scan_group</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_scan_ind</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_scan_ind_wheel</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_joint</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_map</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">InputMap</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_main_map</span><span class="p">()</span>
        <span class="p">)</span>  <span class="c1"># always executed, must not change to always be available</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_map</span><span class="p">:</span> <span class="n">InputMap</span>  <span class="c1"># will change</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enter_select_mode</span><span class="p">()</span>

        <span class="n">wpub</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;/leg11/canopen_motor/base_link1_joint_velocity_controller/command&quot;</span><span class="p">,</span>
            <span class="s2">&quot;/leg11/canopen_motor/base_link2_joint_velocity_controller/command&quot;</span><span class="p">,</span>
            <span class="s2">&quot;/leg12/canopen_motor/base_link1_joint_velocity_controller/command&quot;</span><span class="p">,</span>
            <span class="s2">&quot;/leg12/canopen_motor/base_link2_joint_velocity_controller/command&quot;</span><span class="p">,</span>
            <span class="s2">&quot;/leg13/canopen_motor/base_link1_joint_velocity_controller/command&quot;</span><span class="p">,</span>
            <span class="s2">&quot;/leg13/canopen_motor/base_link2_joint_velocity_controller/command&quot;</span><span class="p">,</span>
            <span class="s2">&quot;/leg14/canopen_motor/base_link1_joint_velocity_controller/command&quot;</span><span class="p">,</span>
            <span class="s2">&quot;/leg14/canopen_motor/base_link2_joint_velocity_controller/command&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">Float64</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">wpub</span><span class="p">]</span>

        <span class="c1"># joy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_axes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_buttons</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deadzone</span> <span class="o">=</span> <span class="mf">0.05</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neutral_threshold</span> <span class="o">=</span> <span class="mf">0.2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_neutral_axes</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_movement</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;roll&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;pitch&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;yaw&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;x_prev&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;y_prev&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;z_prev&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;roll_prev&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;pitch_prev&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;yaw_prev&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">joint_timer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_timer</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_control_joy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">launch_case</span> <span class="o">=</span> <span class="s2">&quot;HERO&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_mapping</span> <span class="o">=</span> <span class="n">STICKER_TO_ALPHAB</span>

        <span class="c1"># config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_index</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># current</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_configs</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># total configs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_config_button</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># prev config</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sendTargetBody</span><span class="p">:</span> <span class="n">Client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span><span class="n">SendTargetBody</span><span class="p">,</span> <span class="s2">&quot;go2_targetbody&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute_in_cbk_group</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">makeTBclient</span><span class="p">,</span> <span class="n">MutuallyExclusiveCallbackGroup</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">recover_allCLI</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span><span class="n">Trigger</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;leg</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">/driver/recover&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">halt_allCLI</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span><span class="n">Trigger</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;leg</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">/driver/halt&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prev_joy_state</span><span class="p">:</span> <span class="n">JoyState</span> <span class="o">=</span> <span class="n">JoyState</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="p">:</span> <span class="n">JoyState</span> <span class="o">=</span> <span class="n">JoyState</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ik2TMR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_timer</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ik2TMRCBK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ik2TMR</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

        <span class="c1"># self.axis_mapping = {</span>
        <span class="c1">#     &quot;AXIS_LEFT_X&quot;: 1,</span>
        <span class="c1">#     &quot;AXIS_LEFT_Y&quot;: 0,</span>
        <span class="c1">#     &quot;AXIS_RIGHT_X&quot;: 4,</span>
        <span class="c1">#     &quot;AXIS_RIGHT_Y&quot;: 3,</span>
        <span class="c1"># }</span>

        <span class="c1"># self.button_actions = {</span>
        <span class="c1">#     0: &quot;BUTTON_X&quot;,</span>
        <span class="c1">#     4: &quot;BUTTON_L1&quot;,</span>
        <span class="c1">#     9: &quot;BUTTON_OPTIONS&quot;,</span>
        <span class="c1">#     10: &quot;BUTTON_PS&quot;,</span>
        <span class="c1"># }</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">button_pressed</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<div class="viewcode-block" id="KeyGaitNode.makeTBclient">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.makeTBclient">[docs]</a>
    <span class="k">def</span> <span class="nf">makeTBclient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sendTargetBody</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SRV [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sendTargetBody</span><span class="o">.</span><span class="n">srv_name</span><span class="si">}</span><span class="s2">] connected&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.leg_scanTMRCBK">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.leg_scanTMRCBK">[docs]</a>
    <span class="nd">@error_catcher</span>
    <span class="k">def</span> <span class="nf">leg_scanTMRCBK</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Looks for new legs and joints&quot;&quot;&quot;</span>
        <span class="n">potential_leg</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">LEGNUMS_TO_SCAN</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">next_scan_ind</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_scan_ind</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_scan_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">LEGNUMS_TO_SCAN</span><span class="p">)</span>
        <span class="n">has_looped_to_start</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_scan_ind</span>
        <span class="k">if</span> <span class="n">potential_leg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">potential_leg</span><span class="p">]</span><span class="o">.</span><span class="n">joints</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">potential_leg</span><span class="p">]</span><span class="o">.</span><span class="n">look_for_joints</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">has_looped_to_start</span><span class="p">:</span>
                <span class="k">return</span>  <span class="c1"># stops recursion when loops back to 0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">leg_scanTMRCBK</span><span class="p">()</span>  <span class="c1"># continue scanning if already scanned</span>
            <span class="k">return</span>

        <span class="n">cli</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">leg_aliveCLI</span><span class="p">[</span><span class="n">potential_leg</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cli</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leg_scanTMR</span><span class="o">.</span><span class="n">timer_period_ns</span> <span class="o">/</span> <span class="mf">1e9</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hey there leg </span><span class="si">{</span><span class="n">potential_leg</span><span class="si">}</span><span class="s2"> :)&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">potential_leg</span><span class="p">]</span> <span class="o">=</span> <span class="n">Leg</span><span class="p">(</span><span class="n">potential_leg</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">leg_scanTMRCBK</span><span class="p">()</span>  <span class="c1"># continue scanning if leg found</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_looped_to_start</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">leg_scanTMRCBK</span><span class="p">()</span>  <span class="c1"># continue scanning if no legs, unless we looped</span>
            <span class="k">return</span>
        <span class="k">return</span>  <span class="c1"># stops scanning if all fails</span></div>


<div class="viewcode-block" id="KeyGaitNode.wheel_scanTMRCBK">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.wheel_scanTMRCBK">[docs]</a>
    <span class="nd">@error_catcher</span>
    <span class="k">def</span> <span class="nf">wheel_scanTMRCBK</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Looks for new legs and joints&quot;&quot;&quot;</span>
        <span class="n">potential_leg</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">WHEELS_NUM</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">next_scan_ind_wheel</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_scan_ind_wheel</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_scan_ind_wheel</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">WHEELS_NUM</span><span class="p">)</span>
        <span class="n">has_looped_to_start</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_scan_ind_wheel</span>
        <span class="k">if</span> <span class="n">potential_leg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wheels</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wheels</span><span class="p">[</span><span class="n">potential_leg</span><span class="p">]</span><span class="o">.</span><span class="n">look_for_joints</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">has_looped_to_start</span><span class="p">:</span>
                <span class="k">return</span>  <span class="c1"># stops recursion when loops back to 0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wheel_scanTMRCBK</span><span class="p">()</span>  <span class="c1"># continue scanning if already scanned</span>
            <span class="k">return</span>

        <span class="n">cli</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">leg_aliveCLI</span><span class="p">[</span><span class="n">potential_leg</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cli</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leg_scanTMR</span><span class="o">.</span><span class="n">timer_period_ns</span> <span class="o">/</span> <span class="mf">1e9</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hey there wheel </span><span class="si">{</span><span class="n">potential_leg</span><span class="si">}</span><span class="s2"> :)&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wheels</span><span class="p">[</span><span class="n">potential_leg</span><span class="p">]</span> <span class="o">=</span> <span class="n">Wheel</span><span class="p">(</span><span class="n">potential_leg</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wheel_scanTMRCBK</span><span class="p">()</span>  <span class="c1"># continue scanning if leg found</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wheels</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_looped_to_start</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wheel_scanTMRCBK</span><span class="p">()</span>  <span class="c1"># continue scanning if no wheels, unless we looped</span>
            <span class="k">return</span>
        <span class="k">return</span>  <span class="c1"># stops scanning if all fails</span></div>


<div class="viewcode-block" id="KeyGaitNode.refresh_joint_mapping">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.refresh_joint_mapping">[docs]</a>
    <span class="k">def</span> <span class="nf">refresh_joint_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;joint mapping based on leg number (realguy or MoonbotH)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="mi">75</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joint_mapping</span> <span class="o">=</span> <span class="n">STICKER_TO_ALPHAB_LEG75</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">launch_case</span> <span class="o">=</span> <span class="s2">&quot;75&quot;</span>
        <span class="k">elif</span> <span class="mi">16</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joint_mapping</span> <span class="o">=</span> <span class="n">STICKER_TO_ALPHAB_LEG16_ARM</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">launch_case</span> <span class="o">=</span> <span class="s2">&quot;16&quot;</span>
        <span class="k">elif</span> <span class="mi">42</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joint_mapping</span> <span class="o">=</span> <span class="n">STICKER_TO_ALPHAB_LEG42</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">launch_case</span> <span class="o">=</span> <span class="s2">&quot;42&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joint_mapping</span> <span class="o">=</span> <span class="n">STICKER_TO_ALPHAB</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">launch_case</span> <span class="o">=</span> <span class="s2">&quot;HERO&quot;</span></div>

        <span class="c1"># self.pinfo(self.joint_mapping)</span>

<div class="viewcode-block" id="KeyGaitNode.switch_to_grip_ur16">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.switch_to_grip_ur16">[docs]</a>
    <span class="k">def</span> <span class="nf">switch_to_grip_ur16</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;joint mapping based on leg number (realguy or MoonbotH)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="mi">16</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joint_mapping</span> <span class="o">=</span> <span class="n">STICKER_TO_ALPHAB_LEG16_GRIP</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">launch_case</span> <span class="o">=</span> <span class="s2">&quot;16&quot;</span>
            <span class="c1"># self.pinfo(self.joint_mapping)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joint_mapping</span> <span class="o">=</span> <span class="n">STICKER_TO_ALPHAB</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">launch_case</span> <span class="o">=</span> <span class="s2">&quot;HERO&quot;</span></div>


<div class="viewcode-block" id="KeyGaitNode.key_upSUBCBK">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.key_upSUBCBK">[docs]</a>
    <span class="nd">@error_catcher</span>
    <span class="k">def</span> <span class="nf">key_upSUBCBK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes when keyboard released&quot;&quot;&quot;</span>
        <span class="n">key_char</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
        <span class="n">key_code</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">code</span>
        <span class="c1"># self.pinfo(f&quot;chr: {chr(msg.code)}, int: {msg.code}&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_all_joints</span><span class="p">()</span></div>


<div class="viewcode-block" id="KeyGaitNode.stop_all_joints">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.stop_all_joints">[docs]</a>
    <span class="k">def</span> <span class="nf">stop_all_joints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;stops all joint by sending the current angle as target.</span>
<span class="sd">        if speed was set, sends a speed of 0 instead&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">leg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">leg</span><span class="o">.</span><span class="n">joints</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">jobj</span> <span class="o">=</span> <span class="n">leg</span><span class="o">.</span><span class="n">get_joint_obj</span><span class="p">(</span><span class="n">joint</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">jobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">jobj</span><span class="o">.</span><span class="n">angle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">jobj</span><span class="o">.</span><span class="n">_speed_target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">jobj</span><span class="o">.</span><span class="n">apply_angle_target</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="n">jobj</span><span class="o">.</span><span class="n">angle</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">jobj</span><span class="o">.</span><span class="n">apply_speed_target</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.all_wheel_speed">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.all_wheel_speed">[docs]</a>
    <span class="k">def</span> <span class="nf">all_wheel_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Need a re-work&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All wheel speed: </span><span class="si">{</span><span class="n">speed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">speed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=-</span><span class="n">speed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">speed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=-</span><span class="n">speed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=-</span><span class="n">speed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">speed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=-</span><span class="n">speed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">speed</span><span class="p">))</span></div>


<div class="viewcode-block" id="KeyGaitNode.minimal_wheel_speed">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.minimal_wheel_speed">[docs]</a>
    <span class="k">def</span> <span class="nf">minimal_wheel_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Need a re-work&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Minimal wheel speed: </span><span class="si">{</span><span class="n">speed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">speed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=-</span><span class="n">speed</span><span class="p">))</span></div>


<div class="viewcode-block" id="KeyGaitNode.tricycle_wheel_speed">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.tricycle_wheel_speed">[docs]</a>
    <span class="k">def</span> <span class="nf">tricycle_wheel_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Need a re-work&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tricycle wheel speed: </span><span class="si">{</span><span class="n">speed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">speed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=-</span><span class="n">speed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=-</span><span class="n">speed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">speed</span><span class="p">))</span>
        <span class="c1"># self.wpub[4].publish(Float64(data=-speed))</span>
        <span class="c1"># self.wpub[5].publish(Float64(data=-speed))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=-</span><span class="n">speed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">speed</span><span class="p">))</span></div>


<div class="viewcode-block" id="KeyGaitNode.dragon_wheel_speed">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.dragon_wheel_speed">[docs]</a>
    <span class="k">def</span> <span class="nf">dragon_wheel_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Need a re-work&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dragon wheel speed: </span><span class="si">{</span><span class="n">speed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">speed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=-</span><span class="n">speed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=-</span><span class="n">speed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">speed</span><span class="p">))</span></div>


<div class="viewcode-block" id="KeyGaitNode.wheels_speed">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.wheels_speed">[docs]</a>
    <span class="k">def</span> <span class="nf">wheels_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wheels</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Need a re-work&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dragon wheel speed: </span><span class="si">{</span><span class="n">speed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">speed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=-</span><span class="n">speed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=-</span><span class="n">speed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wpub</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Float64</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">speed</span><span class="p">))</span></div>


<div class="viewcode-block" id="KeyGaitNode.key_downSUBCBK">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.key_downSUBCBK">[docs]</a>
    <span class="nd">@error_catcher</span>
    <span class="k">def</span> <span class="nf">key_downSUBCBK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes when keyboard pressed&quot;&quot;&quot;</span>
        <span class="n">key_code</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">code</span>
        <span class="n">key_modifier</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">modifiers</span>
        <span class="c1"># bitwise operation to set numlock and capslock bit to 0</span>
        <span class="n">key_modifier</span> <span class="o">=</span> <span class="n">key_modifier</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">MODIFIER_NUM</span> <span class="o">|</span> <span class="n">Key</span><span class="o">.</span><span class="n">MODIFIER_CAPS</span><span class="p">)</span>
        <span class="c1"># self.pinfo(f&quot;chr: {chr(msg.code)}, mod: {key_modifier:016b}&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_mapping</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_map</span><span class="p">,</span> <span class="p">(</span><span class="n">key_code</span><span class="p">,</span> <span class="n">key_modifier</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_mapping</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sub_map</span><span class="p">,</span> <span class="p">(</span><span class="n">key_code</span><span class="p">,</span> <span class="n">key_modifier</span><span class="p">))</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="KeyGaitNode.default_3legs">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.default_3legs">[docs]</a>
    <span class="k">def</span> <span class="nf">default_3legs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">leg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg</span><span class="p">():</span>
            <span class="n">angs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="mi">0</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mi">3</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
                <span class="mi">4</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mi">5</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
                <span class="mi">6</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mi">7</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                <span class="mi">8</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">leg</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">TRICYCLE_FRONT</span><span class="p">:</span>
                <span class="n">angs</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">leg</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">TRICYCLE_LEFT</span><span class="p">:</span>
                <span class="n">angs</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span>
                <span class="n">angs</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">angs</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">leg</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">TRICYCLE_RIGHT</span><span class="p">:</span>
                <span class="n">angs</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span>
                <span class="n">angs</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">angs</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">leg</span><span class="o">.</span><span class="n">number</span> <span class="ow">in</span> <span class="n">TRICYCLE_FLIPPED</span><span class="p">:</span>
                <span class="c1"># neg = map(lambda x: -x, angs.values())</span>
                <span class="n">neg</span> <span class="o">=</span> <span class="n">angs</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="n">fang</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">angs</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">neg</span><span class="p">)</span>
                <span class="n">angs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fang</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pwarn</span><span class="p">(</span><span class="n">angs</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">ang</span> <span class="ow">in</span> <span class="n">angs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">jobj</span> <span class="o">=</span> <span class="n">leg</span><span class="o">.</span><span class="n">get_joint_obj</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">jobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">jobj</span><span class="o">.</span><span class="n">apply_angle_target</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.align_with">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.align_with">[docs]</a>
    <span class="k">def</span> <span class="nf">align_with</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leg_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">quat_leg1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">leg_number</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">quat_leg1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pwarn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;no leg </span><span class="si">{</span><span class="n">leg_number</span><span class="si">}</span><span class="s2"> to align with&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">quat_leg1</span> <span class="o">=</span> <span class="n">quat_leg1</span><span class="o">.</span><span class="n">quat_now</span>
        <span class="k">for</span> <span class="n">leg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg</span><span class="p">():</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">leg</span><span class="o">.</span><span class="n">xyz_now</span>
            <span class="n">leg</span><span class="o">.</span><span class="n">ik</span><span class="p">(</span><span class="n">xyz</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">quat</span><span class="o">=</span><span class="n">quat_leg1</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.default_vehicle">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.default_vehicle">[docs]</a>
    <span class="k">def</span> <span class="nf">default_vehicle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">vehicle_leg</span> <span class="o">=</span> <span class="n">VEHICLE_BRIDGE</span>
        <span class="n">angs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
            <span class="mi">6</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">7</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="mi">8</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">vehicle_leg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg_keys</span><span class="p">():</span>
            <span class="n">manip_leg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">vehicle_leg</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">ang</span> <span class="ow">in</span> <span class="n">angs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">jobj</span> <span class="o">=</span> <span class="n">manip_leg</span><span class="o">.</span><span class="n">get_joint_obj</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">jobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">jobj</span><span class="o">.</span><span class="n">apply_angle_target</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span>
            <span class="k">return</span></div>


<div class="viewcode-block" id="KeyGaitNode.default_dragon">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.default_dragon">[docs]</a>
    <span class="k">def</span> <span class="nf">default_dragon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">main_leg_ind</span> <span class="o">=</span> <span class="n">DRAGON_MAIN</span>  <span class="c1"># default for all moves</span>
        <span class="k">if</span> <span class="n">main_leg_ind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg_keys</span><span class="p">():</span>
            <span class="n">main_leg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">main_leg_ind</span><span class="p">]</span>  <span class="c1"># default for all moves</span>
            <span class="n">main_leg</span><span class="o">.</span><span class="n">ik</span><span class="p">(</span><span class="n">xyz</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">quat</span><span class="o">=</span><span class="n">qt</span><span class="o">.</span><span class="n">from_euler_angles</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>

        <span class="n">manip_leg_ind</span> <span class="o">=</span> <span class="n">DRAGON_MANIP</span>
        <span class="n">angs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="mi">4</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span>
            <span class="mi">6</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">7</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">8</span><span class="p">),</span>
            <span class="mi">8</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">manip_leg_ind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg_keys</span><span class="p">():</span>
            <span class="n">manip_leg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">manip_leg_ind</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">ang</span> <span class="ow">in</span> <span class="n">angs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">jobj</span> <span class="o">=</span> <span class="n">manip_leg</span><span class="o">.</span><span class="n">get_joint_obj</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">jobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">jobj</span><span class="o">.</span><span class="n">apply_angle_target</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span>
            <span class="k">return</span></div>


<div class="viewcode-block" id="KeyGaitNode.dragon_align">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.dragon_align">[docs]</a>
    <span class="k">def</span> <span class="nf">dragon_align</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">DRAGON_MAIN</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg_keys</span><span class="p">():</span>
            <span class="n">main_leg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">DRAGON_MAIN</span><span class="p">]</span>  <span class="c1"># default for all moves</span>
            <span class="k">if</span> <span class="n">main_leg</span><span class="o">.</span><span class="n">xyz_now</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="mi">1200</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xy</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">=</span> <span class="n">main_leg</span><span class="o">.</span><span class="n">xyz_now</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xy</span><span class="p">))</span>
            <span class="n">main_leg</span><span class="o">.</span><span class="n">ik</span><span class="p">(</span>
                <span class="n">xyz</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">dist</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">quat</span><span class="o">=</span><span class="n">qt</span><span class="o">.</span><span class="n">from_euler_angles</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">qt</span><span class="o">.</span><span class="n">one</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">DRAGON_MANIP</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg_keys</span><span class="p">():</span>
            <span class="n">manip_leg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">DRAGON_MANIP</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">manip_leg</span><span class="o">.</span><span class="n">xyz_now</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xyz</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xy</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">=</span> <span class="n">manip_leg</span><span class="o">.</span><span class="n">xyz_now</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xy</span><span class="p">))</span>
                <span class="n">xyz</span> <span class="o">=</span> <span class="p">[</span><span class="n">dist</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">manip_leg</span><span class="o">.</span><span class="n">xyz_now</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
            <span class="n">manip_leg</span><span class="o">.</span><span class="n">ik</span><span class="p">(</span><span class="n">xyz</span><span class="o">=</span><span class="n">xyz</span><span class="p">,</span> <span class="n">quat</span><span class="o">=</span><span class="n">qt</span><span class="o">.</span><span class="n">one</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.dragon_front_left">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.dragon_front_left">[docs]</a>
    <span class="k">def</span> <span class="nf">dragon_front_left</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">from_rotation_vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goToTargetBody</span><span class="p">(</span><span class="n">bodyQuat</span><span class="o">=</span><span class="n">rot</span><span class="p">,</span> <span class="n">blocking</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.dragon_front_right">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.dragon_front_right">[docs]</a>
    <span class="k">def</span> <span class="nf">dragon_front_right</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">from_rotation_vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goToTargetBody</span><span class="p">(</span><span class="n">bodyQuat</span><span class="o">=</span><span class="n">rot</span><span class="p">,</span> <span class="n">blocking</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.dragon_base_lookup">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.dragon_base_lookup">[docs]</a>
    <span class="k">def</span> <span class="nf">dragon_base_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">from_rotation_vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goToTargetBody</span><span class="p">(</span><span class="n">bodyQuat</span><span class="o">=</span><span class="n">rot</span><span class="p">,</span> <span class="n">blocking</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.dragon_base_lookdown">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.dragon_base_lookdown">[docs]</a>
    <span class="k">def</span> <span class="nf">dragon_base_lookdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">from_rotation_vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goToTargetBody</span><span class="p">(</span><span class="n">bodyQuat</span><span class="o">=</span><span class="n">rot</span><span class="p">,</span> <span class="n">blocking</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.dragon_back_left">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.dragon_back_left">[docs]</a>
    <span class="k">def</span> <span class="nf">dragon_back_left</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">main_leg_ind</span> <span class="o">=</span> <span class="n">DRAGON_MAIN</span>  <span class="c1"># default for all moves</span>
        <span class="n">main_leg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">main_leg_ind</span><span class="p">]</span>  <span class="c1"># default for all moves</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">from_rotation_vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]))</span>
        <span class="n">main_leg</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">quat</span><span class="o">=</span><span class="n">rot</span><span class="p">,</span> <span class="n">blocking</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.dragon_back_right">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.dragon_back_right">[docs]</a>
    <span class="k">def</span> <span class="nf">dragon_back_right</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">main_leg_ind</span> <span class="o">=</span> <span class="n">DRAGON_MAIN</span>  <span class="c1"># default for all moves</span>
        <span class="n">main_leg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">main_leg_ind</span><span class="p">]</span>  <span class="c1"># default for all moves</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">from_rotation_vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">]))</span>
        <span class="n">main_leg</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">quat</span><span class="o">=</span><span class="n">rot</span><span class="p">,</span> <span class="n">blocking</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.zero_without_grippers">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.zero_without_grippers">[docs]</a>
    <span class="k">def</span> <span class="nf">zero_without_grippers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">angs_75</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span> <span class="mf">1.5708</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.5708</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">:</span> <span class="mf">1.5708</span><span class="p">,</span>
            <span class="mi">6</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">angs_75_actual</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">6</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">angs_16</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.5708</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="c1"># 13: 0.0,</span>
            <span class="c1"># 12: 0.0,</span>
            <span class="c1"># 0: -1.5708,</span>
            <span class="c1"># 14: 0.0,</span>
            <span class="c1"># 15: 0.0,</span>
            <span class="c1"># 16: 0.0,</span>
        <span class="p">}</span>
        <span class="n">angs_hero</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">6</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">7</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">8</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">angs_42</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_case</span> <span class="o">==</span> <span class="s2">&quot;75&quot;</span><span class="p">:</span>
            <span class="n">angs</span> <span class="o">=</span> <span class="n">angs_75</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_case</span> <span class="o">==</span> <span class="s2">&quot;16&quot;</span><span class="p">:</span>
            <span class="n">angs</span> <span class="o">=</span> <span class="n">angs_16</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_case</span> <span class="o">==</span> <span class="s2">&quot;42&quot;</span><span class="p">:</span>
            <span class="n">angs</span> <span class="o">=</span> <span class="n">angs_42</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">angs</span> <span class="o">=</span> <span class="n">angs_hero</span>
        <span class="k">for</span> <span class="n">leg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg</span><span class="p">():</span>
            <span class="c1"># for leg in [self.legs[4]]:</span>
            <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">ang</span> <span class="ow">in</span> <span class="n">angs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">jobj</span> <span class="o">=</span> <span class="n">leg</span><span class="o">.</span><span class="n">get_joint_obj</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">jobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">jobj</span><span class="o">.</span><span class="n">apply_angle_target</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span></div>


    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">goToTargetBody</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bodyXYZ</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bodyQuat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Quaternion</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">blocking</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Future</span><span class="p">:</span> <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">goToTargetBody</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bodyXYZ</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bodyQuat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Quaternion</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">blocking</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SendTargetBody</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span> <span class="o">...</span>

<div class="viewcode-block" id="KeyGaitNode.goToTargetBody">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.goToTargetBody">[docs]</a>
    <span class="k">def</span> <span class="nf">goToTargetBody</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bodyXYZ</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bodyQuat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Quaternion</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">blocking</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Future</span><span class="p">,</span> <span class="n">SendTargetBody</span><span class="o">.</span><span class="n">Response</span><span class="p">]:</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">TargetBody</span><span class="p">(</span>
            <span class="n">target_set</span><span class="o">=</span><span class="n">np2TargetSet</span><span class="p">(</span><span class="n">ts</span><span class="p">),</span>
            <span class="n">body</span><span class="o">=</span><span class="n">np2tf</span><span class="p">(</span><span class="n">bodyXYZ</span><span class="p">,</span> <span class="n">bodyQuat</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">SendTargetBody</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">target_body</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">blocking</span><span class="p">:</span>
            <span class="n">call</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sendTargetBody</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">call</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">call</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sendTargetBody</span><span class="o">.</span><span class="n">call_async</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">call</span></div>


<div class="viewcode-block" id="KeyGaitNode.euler_to_quaternion">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.euler_to_quaternion">[docs]</a>
    <span class="k">def</span> <span class="nf">euler_to_quaternion</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">roll</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">yaw</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Quaternion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert Euler angles to a quaternion.</span>

<span class="sd">        Args:</span>
<span class="sd">            roll (float): Rotation around the X-axis in radians.</span>
<span class="sd">            pitch (float): Rotation around the Y-axis in radians.</span>
<span class="sd">            yaw (float): Rotation around the Z-axis in radians.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Quaternion: The resulting quaternion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create quaternions for each rotation</span>
        <span class="n">qx</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">from_rotation_vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">roll</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="n">qy</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">from_rotation_vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="n">qz</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">from_rotation_vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yaw</span><span class="p">]))</span>

        <span class="c1"># Combine them: Note that quaternion multiplication is not commutative</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">qz</span> <span class="o">*</span> <span class="n">qy</span> <span class="o">*</span> <span class="n">qx</span>
        <span class="k">return</span> <span class="n">q</span></div>


<div class="viewcode-block" id="KeyGaitNode.msg_to_JoyBits">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.msg_to_JoyBits">[docs]</a>
    <span class="k">def</span> <span class="nf">msg_to_JoyBits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Joy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JoyState</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts a joy msg to a JoyState&quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">JoyState</span><span class="p">()</span>
        <span class="n">but</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">buttons</span>  <span class="c1"># type:ignore</span>
        <span class="n">axes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">axes</span>  <span class="c1"># type:ignore</span>
        <span class="n">sticks_raw</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>  <span class="c1"># type:ignore</span>
        <span class="c1"># triggers are already included in the but list</span>
        <span class="n">triggers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span>  <span class="c1"># type:ignore</span>
        <span class="n">dpad_raw</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>  <span class="c1"># type:ignore</span>
        <span class="n">bfield</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># buttons</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">but</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="n">bfield</span> <span class="o">=</span> <span class="n">bfield</span> <span class="o">|</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">)</span>
        <span class="c1"># dpad</span>
        <span class="n">next_bit_to_set</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">dpad</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">dpad_raw</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">dpad_raw</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">dpad_raw</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="n">dpad_raw</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dpad</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="n">next_bit_to_set</span>
            <span class="n">ax_active</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">bfield</span> <span class="o">=</span> <span class="n">bfield</span> <span class="o">|</span> <span class="p">(</span><span class="n">ax_active</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">)</span>
        <span class="c1"># sticks</span>
        <span class="n">next_bit_to_set</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sticks_raw</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">:</span>
                <span class="n">sticks_raw</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="n">state</span><span class="o">.</span><span class="n">stickL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sticks_raw</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">stickL</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">stickL</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>  <span class="c1"># changes xy</span>
        <span class="n">ax_active</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">stickL</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="c1"># self.pwarn(ax_active)</span>
        <span class="n">bfield</span> <span class="o">=</span> <span class="n">bfield</span> <span class="o">|</span> <span class="p">(</span><span class="n">ax_active</span> <span class="o">&lt;&lt;</span> <span class="n">BUTT_BITS</span><span class="p">[</span><span class="s2">&quot;stickL&quot;</span><span class="p">])</span>  <span class="c1"># using * is bad</span>

        <span class="n">state</span><span class="o">.</span><span class="n">stickR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sticks_raw</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">stickR</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">stickR</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>  <span class="c1"># changes xy</span>
        <span class="n">ax_active</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">stickR</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">bfield</span> <span class="o">=</span> <span class="n">bfield</span> <span class="o">|</span> <span class="p">(</span><span class="n">ax_active</span> <span class="o">&lt;&lt;</span> <span class="n">BUTT_BITS</span><span class="p">[</span><span class="s2">&quot;stickR&quot;</span><span class="p">])</span>  <span class="c1"># using * is bad</span>

        <span class="n">state</span><span class="o">.</span><span class="n">L2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">triggers</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">state</span><span class="o">.</span><span class="n">R2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">triggers</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">state</span><span class="o">.</span><span class="n">bits</span> <span class="o">=</span> <span class="n">bfield</span>

        <span class="k">return</span> <span class="n">state</span></div>


<div class="viewcode-block" id="KeyGaitNode.display_JoyBits">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.display_JoyBits">[docs]</a>
    <span class="k">def</span> <span class="nf">display_JoyBits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joy_state</span><span class="p">:</span> <span class="n">JoyState</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bits: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">bits</span><span class="si">:</span><span class="s2">018b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ints: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">bits</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;stick L: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">stickL</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;stick R: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">stickR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;trig L: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">L2</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;trig R: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">R2</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="KeyGaitNode.any_pressed">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.any_pressed">[docs]</a>
    <span class="k">def</span> <span class="nf">any_pressed</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">bits</span><span class="p">:</span> <span class="n">JoyBits</span><span class="p">,</span> <span class="n">button_names</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ButtonName</span><span class="p">],</span> <span class="n">ButtonName</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if any button in the list is pressed.</span>

<span class="sd">        Args:</span>
<span class="sd">            bits: set of joybits to check against</span>
<span class="sd">            button_names: list of button names to check if True</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if any bit corresponding to a button is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">button_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">button_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">button_names</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">button_names</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">BUTT_INTS</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;Button </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> does not exist&quot;</span>

        <span class="n">arr_of_joybits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">BUTT_INTS</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">button_names</span><span class="p">])</span>
        <span class="n">fused_joybits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bitwise_or</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">arr_of_joybits</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">bits</span> <span class="o">&amp;</span> <span class="n">fused_joybits</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="KeyGaitNode.bits2name">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.bits2name">[docs]</a>
    <span class="k">def</span> <span class="nf">bits2name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bits</span><span class="p">:</span> <span class="n">JoyBits</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ButtonName</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts a bit field to a list of button names&quot;&quot;&quot;</span>
        <span class="n">button_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ButtonName</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">bits</span><span class="p">:</span>  <span class="c1"># handles several button pressed at the same time</span>
            <span class="c1"># to handle rare edge cases</span>
            <span class="n">isolated_bit</span> <span class="o">=</span> <span class="n">bits</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">bits</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_bit2name</span><span class="p">(</span><span class="n">isolated_bit</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">button_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">bits</span> <span class="o">&amp;=</span> <span class="n">bits</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">button_names</span></div>


<div class="viewcode-block" id="KeyGaitNode.one_bit2name">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.one_bit2name">[docs]</a>
    <span class="k">def</span> <span class="nf">one_bit2name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bits</span><span class="p">:</span> <span class="n">JoyBits</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ButtonName</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts a bit field with 1 bit to 1, to a single button name&quot;&quot;&quot;</span>
        <span class="n">button_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ButtonName</span><span class="p">]</span> <span class="o">=</span> <span class="n">INTS_BUTT</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">button_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown bit: </span><span class="si">{</span><span class="p">(</span><span class="n">bits</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">-</span><span class="n">bits</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bits</span><span class="si">:</span><span class="s2">018b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">button_name</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">button_name</span> <span class="o">==</span> <span class="s2">&quot;NONE&quot;</span> <span class="k">else</span> <span class="n">button_name</span>
        <span class="k">return</span> <span class="n">button_name</span></div>


<div class="viewcode-block" id="KeyGaitNode.joy_pressed">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.joy_pressed">[docs]</a>
    <span class="k">def</span> <span class="nf">joy_pressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button_name</span><span class="p">:</span> <span class="n">ButtonName</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes for each button that is pressed. Like a callback.</span>

<span class="sd">        Args:</span>
<span class="sd">            bits: Should only have one single bit set to 1, for 1 single button</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dic_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">button_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">bits</span><span class="p">)</span>
        <span class="c1"># self.pinfo(f&quot;pressed: {dic_key}&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_mapping</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_map</span><span class="p">,</span> <span class="n">dic_key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_mapping</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sub_map</span><span class="p">,</span> <span class="n">dic_key</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.joy_released">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.joy_released">[docs]</a>
    <span class="k">def</span> <span class="nf">joy_released</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button_name</span><span class="p">:</span> <span class="n">ButtonName</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes for each button that is released. Like a callback.</span>

<span class="sd">        Args:</span>
<span class="sd">            bits: Should only have one single bit set to 1, for 1 single button</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dic_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">button_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">bits</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_all_joints</span><span class="p">()</span></div>

        <span class="c1"># self.pinfo(f&quot;released: {dic_key}&quot;)</span>

<div class="viewcode-block" id="KeyGaitNode.get_joint_index">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.get_joint_index">[docs]</a>
    <span class="k">def</span> <span class="nf">get_joint_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selected_joint</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="c1"># self.pinfo(f&quot;yes: {self.joint_mapping}&quot;)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">selected_joint</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.joySUBCBK">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.joySUBCBK">[docs]</a>
    <span class="nd">@error_catcher</span>
    <span class="k">def</span> <span class="nf">joySUBCBK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Joy</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Processes incomming joy messages.</span>
<span class="sd">        Converts and stores the received state in self.joy_state .</span>
<span class="sd">        executes self.joy_pressed and self.joy_released for each button that changed state</span>

<span class="sd">        Args:</span>
<span class="sd">            msg: Ros2 Joy message type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.display_JoyBits(0)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_joy_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_to_JoyBits</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">button_downed</span><span class="p">:</span> <span class="n">JoyBits</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">prev_joy_state</span><span class="o">.</span><span class="n">bits</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">bits</span>
        <span class="n">downed_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ButtonName</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bits2name</span><span class="p">(</span><span class="n">button_downed</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">downed_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joy_pressed</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="n">button_upped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_joy_state</span><span class="o">.</span><span class="n">bits</span> <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">bits</span>
        <span class="n">upped_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ButtonName</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bits2name</span><span class="p">(</span><span class="n">button_upped</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">upped_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joy_released</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="KeyGaitNode.joint_control_joy">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.joint_control_joy">[docs]</a>
    <span class="k">def</span> <span class="nf">joint_control_joy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">bits</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">any_pressed</span><span class="p">(</span><span class="n">bits</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;stickL&quot;</span><span class="p">,</span> <span class="s2">&quot;stickR&quot;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joint_timer</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="n">stick_directions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;stickL_vert&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">stickL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">stickL</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">),</span>
            <span class="s2">&quot;stickL_horiz&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">stickL</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">stickL</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">),</span>
            <span class="s2">&quot;stickR_vert&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">stickR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">stickR</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">),</span>
            <span class="s2">&quot;stickR_horiz&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">stickR</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">stickR</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">),</span>
        <span class="p">}</span>

        <span class="n">joint_mapping_default</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="s2">&quot;L1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickL_vert&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;L1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickL_horiz&quot;</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;L1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickR_vert&quot;</span><span class="p">):</span> <span class="mi">9</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;L1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickR_horiz&quot;</span><span class="p">):</span> <span class="mi">8</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickL_vert&quot;</span><span class="p">):</span> <span class="mi">3</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickL_horiz&quot;</span><span class="p">):</span> <span class="mi">4</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickR_vert&quot;</span><span class="p">):</span> <span class="mi">7</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickR_horiz&quot;</span><span class="p">):</span> <span class="mi">6</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;L2&quot;</span><span class="p">,</span> <span class="s2">&quot;stickL_vert&quot;</span><span class="p">):</span> <span class="mi">5</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">joint_mapping_75</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="s2">&quot;L1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickL_vert&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;L1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickL_horiz&quot;</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;L1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickR_vert&quot;</span><span class="p">):</span> <span class="mi">3</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;L1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickR_horiz&quot;</span><span class="p">):</span> <span class="mi">4</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickL_vert&quot;</span><span class="p">):</span> <span class="mi">5</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickL_horiz&quot;</span><span class="p">):</span> <span class="mi">6</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickR_vert&quot;</span><span class="p">):</span> <span class="mi">7</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">joint_mapping_16</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="s2">&quot;L1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickL_vert&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;L1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickL_horiz&quot;</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;L1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickR_vert&quot;</span><span class="p">):</span> <span class="mi">3</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;L1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickR_horiz&quot;</span><span class="p">):</span> <span class="mi">4</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickL_vert&quot;</span><span class="p">):</span> <span class="mi">5</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;stickL_horiz&quot;</span><span class="p">):</span> <span class="mi">6</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">joint_mapping</span> <span class="o">=</span> <span class="n">joint_mapping_default</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_case</span> <span class="o">==</span> <span class="s2">&quot;75&quot;</span><span class="p">:</span>
            <span class="n">joint_mapping</span> <span class="o">=</span> <span class="n">joint_mapping_75</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_case</span> <span class="o">==</span> <span class="s2">&quot;16&quot;</span><span class="p">:</span>
            <span class="n">joint_mapping</span> <span class="o">=</span> <span class="n">joint_mapping_16</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">joint_mapping</span> <span class="o">=</span> <span class="n">joint_mapping_default</span>

        <span class="n">held_buttons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">any_pressed</span><span class="p">(</span><span class="n">bits</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;L1&quot;</span><span class="p">]):</span>
            <span class="n">held_buttons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;L1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">any_pressed</span><span class="p">(</span><span class="n">bits</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;R1&quot;</span><span class="p">]):</span>
            <span class="n">held_buttons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">any_pressed</span><span class="p">(</span><span class="n">bits</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;L2&quot;</span><span class="p">]):</span>
            <span class="n">held_buttons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;L2&quot;</span><span class="p">)</span>

        <span class="n">selected_joint</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">stick_to_use</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># find the matching joint to held button and active stick</span>
        <span class="k">for</span> <span class="n">button</span> <span class="ow">in</span> <span class="n">held_buttons</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">direction</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">stick_directions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span> <span class="ow">in</span> <span class="n">joint_mapping</span><span class="p">:</span>
                    <span class="n">selected_joint</span> <span class="o">=</span> <span class="n">joint_mapping</span><span class="p">[(</span><span class="n">button</span><span class="p">,</span> <span class="n">direction</span><span class="p">)]</span>
                    <span class="n">stick_to_use</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">selected_joint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">selected_joint</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">stick_to_use</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">joint_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_joint_index</span><span class="p">(</span><span class="n">selected_joint</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">joint_ind</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">inc_value</span> <span class="o">=</span> <span class="n">stick_to_use</span> <span class="o">*</span> <span class="n">MAX_JOINT_SPEED</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg_keys</span><span class="p">():</span>
            <span class="n">leg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">jobj</span> <span class="o">=</span> <span class="n">leg</span><span class="o">.</span><span class="n">get_joint_obj</span><span class="p">(</span><span class="n">joint_ind</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">jobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">jobj</span><span class="o">.</span><span class="n">apply_speed_target</span><span class="p">(</span><span class="n">inc_value</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.joint_timer_start">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.joint_timer_start">[docs]</a>
    <span class="k">def</span> <span class="nf">joint_timer_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_timer</span><span class="o">.</span><span class="n">is_canceled</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joint_timer</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span></div>


<div class="viewcode-block" id="KeyGaitNode.collapseT_KeyCodeModifier">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.collapseT_KeyCodeModifier">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">collapseT_KeyCodeModifier</span><span class="p">(</span><span class="n">variable</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">KeyCodeModifier</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Collapses the variable onto a KeyCodeModifier type, or None</span>

<span class="sd">        Returns:</span>
<span class="sd">            None if variable is not a KCM</span>
<span class="sd">            The variable as a KCM type-hint if it is a KCM</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">variable</span>
        <span class="k">if</span> <span class="n">variable</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">ANY</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">variable</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="KeyGaitNode.collapseT_JoyCodeModifier">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.collapseT_JoyCodeModifier">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">collapseT_JoyCodeModifier</span><span class="p">(</span><span class="n">variable</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">JoyCodeModifier</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Collapses the variable onto a JoyCodeModifier type, or None</span>

<span class="sd">        Returns:</span>
<span class="sd">            None if variable is not a JCM</span>
<span class="sd">            The variable as a JCM type-hint if it is a JCM</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">JoyBits</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">variable</span>
        <span class="k">if</span> <span class="n">variable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">ANY</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">variable</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="KeyGaitNode.remap_onto_any">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.remap_onto_any">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remap_onto_any</span><span class="p">(</span><span class="n">mapping</span><span class="p">:</span> <span class="n">InputMap</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">UserInput</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;runs the input through the INPUTMap as if the key_modifier was any</span>
<span class="sd">        if it is already, it does not run it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">collapsed_KCM</span> <span class="o">=</span> <span class="n">KeyGaitNode</span><span class="o">.</span><span class="n">collapseT_KeyCodeModifier</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">collapsed_KCM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># is KCM</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">collapsed_KCM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">ANY</span><span class="p">:</span>
                <span class="c1"># we run the connection (again?), replacing the key_modifier with ANY</span>
                <span class="n">KeyGaitNode</span><span class="o">.</span><span class="n">connect_mapping</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="p">(</span><span class="n">collapsed_KCM</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ANY</span><span class="p">))</span>

        <span class="n">collapsed_JCM</span> <span class="o">=</span> <span class="n">KeyGaitNode</span><span class="o">.</span><span class="n">collapseT_JoyCodeModifier</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">collapsed_JCM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># is JCM</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">collapsed_JCM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">ANY</span><span class="p">:</span>
                <span class="c1"># we run the connection (again?), replacing the key_modifier with ANY</span>
                <span class="n">KeyGaitNode</span><span class="o">.</span><span class="n">connect_mapping</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="p">(</span><span class="n">collapsed_JCM</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ANY</span><span class="p">))</span></div>


<div class="viewcode-block" id="KeyGaitNode.connect_mapping">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.connect_mapping">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">connect_mapping</span><span class="p">(</span><span class="n">mapping</span><span class="p">:</span> <span class="n">InputMap</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">UserInput</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given the user input, executes the corresponding function mapping</span>

<span class="sd">        Args:</span>
<span class="sd">            mapping: Dict of function to execute</span>
<span class="sd">            input: key to the entry to execute</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">KeyGaitNode</span><span class="o">.</span><span class="n">remap_onto_any</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">input</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="n">to_execute</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">NakedCall</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="nb">input</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">to_execute</span><span class="p">:</span>
            <span class="n">f</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="KeyGaitNode.select_leg">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.select_leg">[docs]</a>
    <span class="k">def</span> <span class="nf">select_leg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leg_ind</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Selects the leg(s) for operation. If None select all.</span>

<span class="sd">        Args:</span>
<span class="sd">            leg_ind: List of leg keys (leg numbers) to use</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="s2">&quot;Cannot select: no legs yet&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">leg_ind</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Controling: leg </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">legnum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">legnum</span><span class="p">]</span><span class="o">.</span><span class="n">self_report</span><span class="p">())</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">leg_ind</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pwarn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Leg </span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Controling: leg </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

        <span class="c1"># for legnum in self.selected_legs:</span>
        <span class="c1"># self.pinfo(self.legs[legnum].self_report)</span>

<div class="viewcode-block" id="KeyGaitNode.cycle_leg_selection">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.cycle_leg_selection">[docs]</a>
    <span class="k">def</span> <span class="nf">cycle_leg_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">increment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cycles the leg selection by increment</span>
<span class="sd">        if None, selects all known legs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="s2">&quot;Cannot select: no legs yet&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">leg_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">increment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span> <span class="o">=</span> <span class="n">leg_keys</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">first_leg</span> <span class="o">=</span> <span class="n">leg_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span> <span class="o">=</span> <span class="p">[</span><span class="n">first_leg</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">next_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="p">(</span><span class="n">leg_keys</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">increment</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">legs</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span> <span class="o">=</span> <span class="p">[</span><span class="n">leg_keys</span><span class="p">[</span><span class="n">next_index</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Controling: leg </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.get_active_leg">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.get_active_leg">[docs]</a>
    <span class="k">def</span> <span class="nf">get_active_leg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leg_key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Leg</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the keys to get the current active legs from the self.legs dict</span>

<span class="sd">        Args:</span>
<span class="sd">            leg_number: you can specify a leg key if you need instead of using active legs</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of active leg keys</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg_keys</span><span class="p">(</span><span class="n">leg_key</span><span class="p">)]</span></div>


<div class="viewcode-block" id="KeyGaitNode.get_active_leg_keys">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.get_active_leg_keys">[docs]</a>
    <span class="k">def</span> <span class="nf">get_active_leg_keys</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">leg_key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the keys to get the current active legs from the self.legs dict</span>

<span class="sd">        Args:</span>
<span class="sd">            leg_number: you can specify a leg key if you need instead of using active legs</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of active leg keys</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">leg_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_leg</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">leg_key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">leg_key</span> <span class="o">=</span> <span class="p">[</span><span class="n">leg_key</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">leg_key</span> <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span><span class="p">]</span></div>


<div class="viewcode-block" id="KeyGaitNode.halt_all">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.halt_all">[docs]</a>
    <span class="k">def</span> <span class="nf">halt_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="s2">&quot;HALTING ALL&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cli</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">halt_allCLI</span><span class="p">:</span>
            <span class="n">cli</span><span class="o">.</span><span class="n">call_async</span><span class="p">(</span><span class="n">Trigger</span><span class="o">.</span><span class="n">Request</span><span class="p">())</span></div>


<div class="viewcode-block" id="KeyGaitNode.halt_detected">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.halt_detected">[docs]</a>
    <span class="k">def</span> <span class="nf">halt_detected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="s2">&quot;HALTING&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">leg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">leg</span><span class="o">.</span><span class="n">halt</span><span class="p">()</span></div>


<div class="viewcode-block" id="KeyGaitNode.recover_all">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.recover_all">[docs]</a>
    <span class="k">def</span> <span class="nf">recover_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leg_keys</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="s2">&quot;RECOVERING ALL&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cli</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">recover_allCLI</span><span class="p">:</span>
            <span class="n">cli</span><span class="o">.</span><span class="n">call_async</span><span class="p">(</span><span class="n">Trigger</span><span class="o">.</span><span class="n">Request</span><span class="p">())</span></div>


<div class="viewcode-block" id="KeyGaitNode.recover_legs">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.recover_legs">[docs]</a>
    <span class="k">def</span> <span class="nf">recover_legs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leg_keys</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="s2">&quot;RECOVERING&quot;</span><span class="p">)</span>
        <span class="n">active_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg_keys</span><span class="p">(</span><span class="n">leg_keys</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">active_keys</span><span class="p">:</span>
            <span class="n">leg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">leg</span><span class="o">.</span><span class="n">recover</span><span class="p">()</span></div>


<div class="viewcode-block" id="KeyGaitNode.set_joint_speed">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.set_joint_speed">[docs]</a>
    <span class="k">def</span> <span class="nf">set_joint_speed</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">joint</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">leg_number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets joint speed or given joints and legs.</span>
<span class="sd">        If Nones, picks the selected or active things</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">joint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">joint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_joint</span>
        <span class="k">if</span> <span class="n">joint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">leg_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg_keys</span><span class="p">(</span><span class="n">leg_number</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">leg_keys</span><span class="p">:</span>
            <span class="n">leg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">jobj</span> <span class="o">=</span> <span class="n">leg</span><span class="o">.</span><span class="n">get_joint_obj</span><span class="p">(</span><span class="n">joint</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">jobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">jobj</span><span class="o">.</span><span class="n">apply_speed_target</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.start_ik2_timer">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.start_ik2_timer">[docs]</a>
    <span class="k">def</span> <span class="nf">start_ik2_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;properly checks and start the timer loop for ik of lvl2&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ik2TMR</span><span class="o">.</span><span class="n">is_canceled</span><span class="p">():</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">Duration</span><span class="p">(</span><span class="n">nanoseconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ik2TMR</span><span class="o">.</span><span class="n">time_since_last_call</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">elapsed</span> <span class="o">&gt;</span> <span class="n">Duration</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">leg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg</span><span class="p">():</span>
                    <span class="n">leg</span><span class="o">.</span><span class="n">reset_ik2_offset</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ik2TMR</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ik2TMR</span><span class="o">.</span><span class="n">callback</span><span class="p">()</span></div>


<div class="viewcode-block" id="KeyGaitNode.ik2TMRCBK">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.ik2TMRCBK">[docs]</a>
    <span class="k">def</span> <span class="nf">ik2TMRCBK</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Timer callback responsable for fast ik movement of lvl2&quot;&quot;&quot;</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">bits</span>
        <span class="n">sticks_active</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">any_pressed</span><span class="p">(</span>
            <span class="n">bits</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s2">&quot;stickR&quot;</span><span class="p">,</span>
                <span class="s2">&quot;stickL&quot;</span><span class="p">,</span>
                <span class="s2">&quot;R2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;L2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;R1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;L1&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sticks_active</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ik2TMR</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c1"># maximum we should move this tick</span>
        <span class="n">speed_xyz</span> <span class="o">=</span> <span class="n">TRANSLATION_SPEED</span>  <span class="c1"># mm/s</span>
        <span class="n">speed_quat</span> <span class="o">=</span> <span class="n">ROTATION_SPEED</span>  <span class="c1"># rad/s</span>
        <span class="n">delta_xyz</span> <span class="o">=</span> <span class="n">speed_xyz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ik2TMR</span><span class="o">.</span><span class="n">timer_period_ns</span> <span class="o">/</span> <span class="mf">1e9</span>
        <span class="n">delta_quat</span> <span class="o">=</span> <span class="n">speed_quat</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ik2TMR</span><span class="o">.</span><span class="n">timer_period_ns</span> <span class="o">/</span> <span class="mf">1e9</span>

        <span class="n">xyz_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">3</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">xyz_input</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">stickL</span>  <span class="c1"># left stick to move</span>
        <span class="n">xyz_input</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">R2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">L2</span>  <span class="c1"># deep triggers to move Z</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="p">(</span><span class="n">bits</span> <span class="o">&amp;</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;R1&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="n">l1</span> <span class="o">=</span> <span class="p">(</span><span class="n">bits</span> <span class="o">&amp;</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;L1&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span>

        <span class="n">x_rot</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">from_rotation_vector</span><span class="p">([</span><span class="o">-</span><span class="n">l1</span> <span class="o">+</span> <span class="n">r1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">y_rot</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">from_rotation_vector</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">stickR</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">z_rot</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">from_rotation_vector</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">joy_state</span><span class="o">.</span><span class="n">stickR</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

        <span class="n">rot</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_rot</span> <span class="o">*</span> <span class="n">y_rot</span> <span class="o">*</span> <span class="n">x_rot</span><span class="p">)</span> <span class="o">**</span> <span class="n">delta_quat</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">send_ik2_offset</span><span class="p">(</span>
            <span class="n">xyz</span><span class="o">=</span><span class="n">xyz_input</span> <span class="o">*</span> <span class="n">delta_xyz</span><span class="p">,</span>
            <span class="n">quat</span><span class="o">=</span><span class="n">rot</span><span class="p">,</span>
            <span class="n">ee_relative</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ik2_ee_mode</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.send_ik2_offset">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.send_ik2_offset">[docs]</a>
    <span class="k">def</span> <span class="nf">send_ik2_offset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">xyz</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">quat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Quaternion</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ee_relative</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">for</span> <span class="n">leg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg</span><span class="p">():</span>
            <span class="n">leg</span><span class="o">.</span><span class="n">apply_ik2_offset</span><span class="p">(</span>
                <span class="n">xyz</span><span class="o">=</span><span class="n">xyz</span><span class="p">,</span>
                <span class="n">quat</span><span class="o">=</span><span class="n">quat</span><span class="p">,</span>
                <span class="n">ee_relative</span><span class="o">=</span><span class="n">ee_relative</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.send_ik2_movement">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.send_ik2_movement">[docs]</a>
    <span class="k">def</span> <span class="nf">send_ik2_movement</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">xyz</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">quat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Quaternion</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ee_relative</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;debug&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">leg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg</span><span class="p">():</span>
            <span class="n">leg</span><span class="o">.</span><span class="n">ik2</span><span class="o">.</span><span class="n">controlled_motion</span><span class="p">(</span>
                <span class="n">xyz</span><span class="o">=</span><span class="n">xyz</span><span class="p">,</span>
                <span class="n">quat</span><span class="o">=</span><span class="n">quat</span><span class="p">,</span>
                <span class="n">ee_relative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.select_joint">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.select_joint">[docs]</a>
    <span class="k">def</span> <span class="nf">select_joint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint_index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;can be better&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_joint</span> <span class="o">=</span> <span class="n">joint_index</span>
        <span class="n">all_controled_joints</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">l_key</span><span class="p">]</span><span class="o">.</span><span class="n">get_joint_obj</span><span class="p">(</span><span class="n">joint_index</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
            <span class="k">for</span> <span class="n">l_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg_keys</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">l_key</span><span class="p">]</span><span class="o">.</span><span class="n">get_joint_obj</span><span class="p">(</span><span class="n">joint_index</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>
        <span class="n">all_reports</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">l_key</span><span class="p">]</span><span class="o">.</span><span class="n">get_joint_obj</span><span class="p">(</span><span class="n">joint_index</span><span class="p">)</span><span class="o">.</span><span class="n">self_report</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">l_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg_keys</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">l_key</span><span class="p">]</span><span class="o">.</span><span class="n">get_joint_obj</span><span class="p">(</span><span class="n">joint_index</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Controling joint: </span><span class="si">{</span><span class="n">all_controled_joints</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">all_reports</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Issue [J]: </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.angle_zero">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.angle_zero">[docs]</a>
    <span class="k">def</span> <span class="nf">angle_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leg_number</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets all joint angles to 0 (dangerous)</span>

<span class="sd">        Args:</span>
<span class="sd">            leg_number: The leg on which to set. If none, applies on the active leg</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">leg_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg_keys</span><span class="p">(</span><span class="n">leg_number</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">leg_keys</span><span class="p">:</span>
            <span class="n">leg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">leg</span><span class="o">.</span><span class="n">go2zero</span><span class="p">()</span></div>


<div class="viewcode-block" id="KeyGaitNode.enter_vehicle_mode">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.enter_vehicle_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">enter_vehicle_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates the sub input map for vehicle</span>

<span class="sd">        Returns:</span>
<span class="sd">            InputMap for joint control</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vehicle Mode.&quot;</span><span class="p">)</span>

        <span class="n">submap</span><span class="p">:</span> <span class="n">InputMap</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_R</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_vehicle</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_O</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragon_wheel_speed</span><span class="p">(</span><span class="mi">10000000</span><span class="p">)],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_P</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragon_wheel_speed</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_L</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragon_wheel_speed</span><span class="p">(</span><span class="o">-</span><span class="mi">10000000</span><span class="p">)],</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_map</span> <span class="o">=</span> <span class="n">submap</span></div>


<div class="viewcode-block" id="KeyGaitNode.enter_dragon_mode">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.enter_dragon_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">enter_dragon_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates the sub input map for dragon</span>

<span class="sd">        Returns:</span>
<span class="sd">            InputMap for joint control</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dragon Mode. MANIPULATOR=</span><span class="si">{</span><span class="n">DRAGON_MANIP</span><span class="si">}</span><span class="s2">, BRIDGE=</span><span class="si">{</span><span class="n">DRAGON_MAIN</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sendTargetBody</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="n">timeout_sec</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">perror</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sendTargetBody</span><span class="o">.</span><span class="n">srv_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sendTargetBody</span><span class="o">.</span><span class="n">srv_type</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;not available. Mover node might not be running.&quot;</span>
            <span class="p">)</span>

        <span class="n">submap</span><span class="p">:</span> <span class="n">InputMap</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_R</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_dragon</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_A</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dragon_back_right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragon_front_left</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_D</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dragon_back_left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragon_front_right</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_G</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dragon_front_left</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_H</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dragon_front_right</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_B</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dragon_back_left</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_N</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dragon_back_right</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_0</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dragon_align</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_O</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragon_wheel_speed</span><span class="p">(</span><span class="mi">10000000</span><span class="p">)],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_P</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragon_wheel_speed</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_L</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragon_wheel_speed</span><span class="p">(</span><span class="o">-</span><span class="mi">10000000</span><span class="p">)],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_UP</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dragon_base_lookup</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_DOWN</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dragon_base_lookdown</span><span class="p">],</span>
            <span class="c1"># joystick mapping</span>
            <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_dragon</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]):</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dragon_back_right</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dragon_front_left</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]):</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dragon_back_left</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dragon_front_right</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;L1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dragon_front_left</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;L1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dragon_front_right</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;R1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dragon_back_left</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;R1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dragon_back_right</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dragon_align</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dragon_base_lookup</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;down&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dragon_base_lookdown</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_map</span> <span class="o">=</span> <span class="n">submap</span></div>


<div class="viewcode-block" id="KeyGaitNode.enter_tricycle_mode">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.enter_tricycle_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">enter_tricycle_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates the sub input map for tricycle</span>

<span class="sd">        Returns:</span>
<span class="sd">            InputMap for joint control</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Tricycle Mode: FRONT=</span><span class="si">{</span><span class="n">TRICYCLE_FRONT</span><span class="si">}</span><span class="s2">, LEFT=</span><span class="si">{</span><span class="n">TRICYCLE_LEFT</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;RIGHT=</span><span class="si">{</span><span class="n">TRICYCLE_RIGHT</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">submap</span><span class="p">:</span> <span class="n">InputMap</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_R</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">MODIFIER_NONE</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_3legs</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_R</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">MODIFIER_LSHIFT</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">align_with</span><span class="p">(</span><span class="n">TRICYCLE_FRONT</span><span class="p">)],</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_map</span> <span class="o">=</span> <span class="n">submap</span></div>


<div class="viewcode-block" id="KeyGaitNode.enter_leg_mode">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.enter_leg_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">enter_leg_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates the sub input map for leg selection</span>

<span class="sd">        Returns:</span>
<span class="sd">            InputMap for leg selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Leg Select Mode: [1,2...] -&gt; Leg 1,2...; [L] [DOWN] -&gt; all Legs; &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;[-&gt;] -&gt; Next; [&lt;-] Previous&quot;</span>
        <span class="p">)</span>
        <span class="n">submap</span><span class="p">:</span> <span class="n">InputMap</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_RIGHT</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle_leg_selection</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_LEFT</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle_leg_selection</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_DOWN</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_leg</span><span class="p">(</span><span class="kc">None</span><span class="p">)],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_L</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_leg</span><span class="p">(</span><span class="kc">None</span><span class="p">)],</span>
            <span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle_leg_selection</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span>
            <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle_leg_selection</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span>
            <span class="p">(</span><span class="s2">&quot;down&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle_leg_selection</span><span class="p">(</span><span class="kc">None</span><span class="p">)],</span>
        <span class="p">}</span>
        <span class="n">one2nine_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">KEY_1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">KEY_2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">KEY_3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">KEY_4</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">KEY_5</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">KEY_6</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">KEY_7</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">KEY_8</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">KEY_9</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">keyb</span> <span class="ow">in</span> <span class="n">one2nine_keys</span><span class="p">:</span>
            <span class="n">submap</span><span class="p">[(</span><span class="n">keyb</span><span class="p">,</span> <span class="n">ANY</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_leg</span><span class="p">([</span><span class="n">n</span><span class="p">])]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_map</span> <span class="o">=</span> <span class="n">submap</span></div>


<div class="viewcode-block" id="KeyGaitNode.ik2_switch_rel_mode">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.ik2_switch_rel_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">ik2_switch_rel_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ik2_ee_mode</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ik2_ee_mode</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ik2_ee_mode</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ik2 control relative to ee: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ik2_ee_mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.inch">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.inch">[docs]</a>
    <span class="k">def</span> <span class="nf">inch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">angs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># 0: -0.3545179120465518,</span>
            <span class="c1"># 3: -0.740027211081219,</span>
            <span class="c1"># 4: 0.20646316846346896,</span>
            <span class="c1"># 5: -3.399630529696763,</span>
            <span class="c1"># 6: -0.19878037213101934,</span>
            <span class="c1"># 7: -1.2519945160585548,</span>
            <span class="c1"># 8: -0.16124285921258164,</span>
            <span class="mi">0</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.28663266887373307</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.3446987231510684</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">:</span> <span class="mf">0.14502818745211818</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.7218462942500934</span><span class="p">,</span>
            <span class="mi">6</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.1959729331860067</span><span class="p">,</span>
            <span class="mi">7</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.7558173432939</span><span class="p">,</span>
            <span class="mi">8</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0669676899566438</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">leg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">ang</span> <span class="ow">in</span> <span class="n">angs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">jobj</span> <span class="o">=</span> <span class="n">leg</span><span class="o">.</span><span class="n">get_joint_obj</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">jobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">ang</span> <span class="o">=</span> <span class="o">-</span><span class="n">ang</span>
                <span class="n">jobj</span><span class="o">.</span><span class="n">apply_angle_target</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.enter_ik2">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.enter_ik2">[docs]</a>
    <span class="k">def</span> <span class="nf">enter_ik2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates the sub input map for ik control lvl2 by elian</span>

<span class="sd">        Returns:</span>
<span class="sd">            InputMap for ik2 control</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;IK2 Mode: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;stick L and deep triggers: xyz movements ; &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;stick R and small triggers: rotations ; &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;x: absolute mode ; &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;o: ee relative mode&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ik2_ee_mode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="n">submap</span><span class="p">:</span> <span class="n">InputMap</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_0</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">zero_without_grippers</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_K</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">reset_ik2_offset</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_leg</span><span class="p">()]</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_I</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">inch</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_W</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_ik2_movement</span><span class="p">(</span>
                    <span class="n">xyz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">TRANSLATION_SPEED</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_S</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_ik2_movement</span><span class="p">(</span>
                    <span class="n">xyz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">TRANSLATION_SPEED</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_A</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_ik2_movement</span><span class="p">(</span>
                    <span class="n">xyz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">TRANSLATION_SPEED</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_D</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_ik2_movement</span><span class="p">(</span>
                    <span class="n">xyz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">TRANSLATION_SPEED</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;stickL&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_ik2_timer</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;stickR&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_ik2_timer</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;R2&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_ik2_timer</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;L2&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_ik2_timer</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_ik2_timer</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;L1&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_ik2_timer</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;L1&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_ik2_timer</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ik2_switch_rel_mode</span><span class="p">(</span><span class="kc">False</span><span class="p">)],</span>
            <span class="p">(</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ik2_switch_rel_mode</span><span class="p">(</span><span class="kc">True</span><span class="p">)],</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_map</span> <span class="o">=</span> <span class="n">submap</span></div>


<div class="viewcode-block" id="KeyGaitNode.enter_joint_mode">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.enter_joint_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">enter_joint_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates the sub input map for joint control</span>

<span class="sd">        Returns:</span>
<span class="sd">            InputMap for joint control</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_joint_mapping</span><span class="p">()</span>
        <span class="c1"># self.pinfo(self.get_active_leg_keys(1))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Joint Control Mode&quot;</span><span class="p">)</span>
        <span class="n">submap</span><span class="p">:</span> <span class="n">InputMap</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_W</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_joint_speed</span><span class="p">(</span><span class="n">MAX_JOINT_SPEED</span><span class="p">)],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_S</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_joint_speed</span><span class="p">(</span><span class="o">-</span><span class="n">MAX_JOINT_SPEED</span><span class="p">)],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_0</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">zero_without_grippers</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_0</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">MODIFIER_LSHIFT</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">angle_zero</span><span class="p">],</span>
            <span class="c1"># wheels</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_O</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimal_wheel_speed</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_L</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimal_wheel_speed</span><span class="p">(</span><span class="o">-</span><span class="mi">10000000</span><span class="p">)],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_P</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimal_wheel_speed</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_I</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wheels</span><span class="o">.</span><span class="n">values</span><span class="p">()]],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_K</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wheels</span><span class="o">.</span><span class="n">values</span><span class="p">()]],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_U</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wheels</span><span class="o">.</span><span class="n">values</span><span class="p">()]],</span>
            <span class="c1"># (Key.KEY_G, ANY): [self.switch_to_grip_ur16],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_R</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh_joint_mapping</span><span class="p">],</span>
            <span class="c1"># joy mapping</span>
            <span class="p">(</span><span class="s2">&quot;stickL&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;stickL&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;L1&quot;</span><span class="p">]):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">joint_timer_start</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;stickR&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;stickR&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;L1&quot;</span><span class="p">]):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">joint_timer_start</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;stickL&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;stickL&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;R1&quot;</span><span class="p">]):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">joint_timer_start</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;stickR&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;stickR&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;R1&quot;</span><span class="p">]):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">joint_timer_start</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;stickL&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;stickL&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;L2&quot;</span><span class="p">]):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">joint_timer_start</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">zero_without_grippers</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">one2nine_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">KEY_1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">KEY_2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">KEY_3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">KEY_4</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">KEY_5</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">KEY_6</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">KEY_7</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">KEY_8</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">KEY_9</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">keyb</span> <span class="ow">in</span> <span class="n">one2nine_keys</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_joint_index</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">submap</span><span class="p">[(</span><span class="n">keyb</span><span class="p">,</span> <span class="n">ANY</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_joint</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_map</span> <span class="o">=</span> <span class="n">submap</span></div>


<div class="viewcode-block" id="KeyGaitNode.no_no_leg">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.no_no_leg">[docs]</a>
    <span class="k">def</span> <span class="nf">no_no_leg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Makes sure no legs are not selected&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_leg</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_legs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_leg</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="KeyGaitNode.enter_select_mode">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.enter_select_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">enter_select_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mode to select other modes.</span>
<span class="sd">        Should always be accessible when pressing ESC key&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Mode Select Mode (Keyboard): &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;J -&gt; Joint, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;L -&gt; Leg, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;K -&gt; IK2&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;D -&gt; Dragon, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;T -&gt; Tricycle&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Mode Select Mode (Joystick): &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;X -&gt; Joint, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;□ -&gt; Leg, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;∆ -&gt; Dragon, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;○ -&gt; IK2&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_J</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">no_no_leg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_joint_mode</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_L</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">no_no_leg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_leg_mode</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_D</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">no_no_leg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_dragon_mode</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_V</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">no_no_leg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_vehicle_mode</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_K</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">no_no_leg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_ik2</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_T</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">no_no_leg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_tricycle_mode</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_SPACE</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">halt_detected</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_SPACE</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">MODIFIER_LSHIFT</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">halt_all</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">no_no_leg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_dragon_mode</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">no_no_leg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_ik2</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">no_no_leg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_joint_mode</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">no_no_leg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_leg_mode</span><span class="p">],</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="KeyGaitNode.easy_mode">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.easy_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">easy_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># I need to make that after easy mode mapping is released it goes back to the previous sub map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinfo</span><span class="p">(</span><span class="s2">&quot;Easy choice mode :)&quot;</span><span class="p">)</span>
        <span class="n">submap</span><span class="p">:</span> <span class="n">InputMap</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;up&quot;</span><span class="p">]):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_wheel_speed</span><span class="p">(</span><span class="mi">100000</span><span class="p">)],</span>
            <span class="p">(</span><span class="s2">&quot;down&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;down&quot;</span><span class="p">]):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_wheel_speed</span><span class="p">(</span><span class="o">-</span><span class="mi">100000</span><span class="p">)],</span>
            <span class="p">(</span><span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;up&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;L1&quot;</span><span class="p">]):</span> <span class="p">[</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimal_wheel_speed</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;down&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;down&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;L1&quot;</span><span class="p">]):</span> <span class="p">[</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimal_wheel_speed</span><span class="p">(</span><span class="o">-</span><span class="mi">100000</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;up&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;R1&quot;</span><span class="p">]):</span> <span class="p">[</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tricycle_wheel_speed</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;down&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;down&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;R1&quot;</span><span class="p">]):</span> <span class="p">[</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tricycle_wheel_speed</span><span class="p">(</span><span class="o">-</span><span class="mi">100000</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;L1&quot;</span><span class="p">]):</span> <span class="p">[</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimal_wheel_speed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;R1&quot;</span><span class="p">]):</span> <span class="p">[</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tricycle_wheel_speed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_wheel_speed</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span>
            <span class="p">(</span><span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;up&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;L2&quot;</span><span class="p">]):</span> <span class="p">[</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragon_wheel_speed</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;down&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;down&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;L2&quot;</span><span class="p">]):</span> <span class="p">[</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragon_wheel_speed</span><span class="p">(</span><span class="o">-</span><span class="mi">100000</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;L2&quot;</span><span class="p">]):</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragon_wheel_speed</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span>
            <span class="c1"># (&quot;R2&quot;, ANY): [self.recover_legs],</span>
            <span class="c1"># (&quot;R2&quot;, BUTT_INTS[&quot;L2&quot;] + BUTT_INTS[&quot;R2&quot;]): [self.recover_all],</span>
            <span class="c1"># (&quot;L2&quot;, BUTT_INTS[&quot;L2&quot;] + BUTT_INTS[&quot;R2&quot;]): [self.recover_all],</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_map</span> <span class="o">=</span> <span class="n">submap</span></div>


<div class="viewcode-block" id="KeyGaitNode.create_main_map">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.KeyGaitNode.create_main_map">[docs]</a>
    <span class="k">def</span> <span class="nf">create_main_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InputMap</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates the main input map, mapping user input to functions,</span>
<span class="sd">        This is supposed to be constant + always active, unlike the sub_map&quot;&quot;&quot;</span>
        <span class="n">main_map</span><span class="p">:</span> <span class="n">InputMap</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># (Key.KEY_O, ANY): [lambda: self.all_wheel_speed(100000)],</span>
            <span class="c1"># (Key.KEY_L, ANY): [lambda: self.all_wheel_speed(-100000)],</span>
            <span class="c1"># (Key.KEY_P, ANY): [lambda: self.all_wheel_speed(0)],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_RETURN</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">recover_legs</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_RETURN</span><span class="p">,</span> <span class="n">Key</span><span class="o">.</span><span class="n">MODIFIER_LSHIFT</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">recover_all</span><span class="p">],</span>
            <span class="p">(</span><span class="n">Key</span><span class="o">.</span><span class="n">KEY_ESCAPE</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">enter_select_mode</span><span class="p">],</span>
            <span class="c1"># joy mapping</span>
            <span class="p">(</span><span class="s2">&quot;option&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">enter_select_mode</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;PS&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">halt_all</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;stickLpush&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;stickLpush&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;stickRpush&quot;</span><span class="p">]):</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">easy_mode</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;stickRpush&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;stickLpush&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;stickRpush&quot;</span><span class="p">]):</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">easy_mode</span>
            <span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;share&quot;</span><span class="p">,</span> <span class="n">ANY</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">recover_legs</span><span class="p">],</span>
            <span class="p">(</span><span class="s2">&quot;share&quot;</span><span class="p">,</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;share&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">BUTT_INTS</span><span class="p">[</span><span class="s2">&quot;stickRpush&quot;</span><span class="p">]):</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">recover_all</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">main_map</span></div>
</div>



<div class="viewcode-block" id="main">
<a class="viewcode-back" href="../../api/easy_robot_control/easy_robot_control.html#easy_robot_control.gait_key_dev.main">[docs]</a>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">myMain</span><span class="p">(</span><span class="n">KeyGaitNode</span><span class="p">,</span> <span class="n">multiThreaded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Elian Neppel.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>